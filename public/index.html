<!DOCTYPE html>
<html>
<head>
    <title>Webhook Dashboard ðŸš€</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f4f9; }
        .card { background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .status { font-weight: bold; }
        .completed { color: green; }
        .failed { color: red; }
        .pending { color: orange; }
    </style>
</head>
<body>
    <h1>Real-Time Job Monitor</h1>
    <div id="job-list">Waiting for jobs...</div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const list = document.getElementById('job-list');

        socket.on('job-update', (job) => {
            console.log("Update received:", job); // Debug log

            // Remove existing card if it exists
            const existing = document.getElementById(`job-${job.id}`);
            if (existing) existing.remove();

            const div = document.createElement('div');
            div.id = `job-${job.id}`;
            div.className = 'card';
            
            // Show Replay button ONLY if Failed
            const isFailed = job.status.toLowerCase().includes('failed');
            const replayBtn = isFailed 
                ? `<button onclick="triggerReplay('${job.id}')" style="background:#e53e3e; color:white; border:none; padding:8px 12px; border-radius:4px; cursor:pointer; font-weight:bold;">â†º Replay</button>` 
                : '';

            div.innerHTML = `
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <strong>Job ID: ${job.id}</strong>
                    ${replayBtn}
                </div>
                <div style="margin-top:5px;">Status: <span class="status ${job.status.toLowerCase()}">${job.status}</span></div>
                <div style="color:#666; font-size:0.9em;">Time: ${new Date().toLocaleTimeString()}</div>
            `;
            list.prepend(div);
        });

        async function triggerReplay(id) {
            alert(`Replaying Job: ${id}`); // Visual confirmation
            await fetch(`/api/events/${id}/replay`, {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json',
                    'x-api-key': 'architect-secret-123' 
                }
            });
        }
    </script>
</body>
</html>